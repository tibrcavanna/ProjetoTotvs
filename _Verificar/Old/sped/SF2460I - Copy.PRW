#include "rwmake.ch" 

//ponto de entrada na gravacao da nota fiscal

User Function SF2460I

Local _cAreaAtu  := getarea()

If SF2->F2_EST == "EX"
   cFata001()
EndIf
   
dbSelectArea("SF2")
RecLock("SF2",.F.)
SF2->F2_ESPECI2 := "" //LIMPA ESSE CAMPO PQ ESTA SENDO USADO PARA INFORMAR A PLACA DO VEICULO
MsUnLock("SF2")

RestArea(_cAreaAtu)

Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ CFATA001 ³ Autor ³ ANTONIO DOMINGOS       ³ Data ³06.09.2016³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Atualiza campos para N.Fiscal EXPORTACAO         	   	   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³ CAVANNA                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function CFATA001()
    
Local  aGetArea    := GetArea()
Local  cF2_TRANSP  := SF2->F2_TRANSP
Local  cF2_ESPECI1 := SF2->F2_ESPECI1
Local  nF2_PBRUTO  := SF2->F2_PBRUTO
Local  nF2_PLIQUI  := SF2->F2_PLIQUI
Local  nF2_VOLUME1 := SF2->F2_VOLUME1
Local  cF2_DOC     := SF2->F2_DOC
Local  nOpc      := 2
Local  cCDL_ESPEC  := SF2->F2_ESPECIE //CriaVar("CDL_ESPEC")  //C  50Especie     Especie     Type        Especie do documento     Especie del documento    Type of Document                                                                                                                                                                                      €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNVR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_INDDOC := CriaVar("CDL_INDDOC")     //C  10Tipo Doc    Tipo Doc    DocumentTypeTipo de documento        Tipo de documento        Document Type            @!                                           Pertence(" 01")                                                                                                                 €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                 0=Declaração de Exportação;1=Declaração simplificada de exportação                                                              0=Declaracion de Exportacion;1=Declaracion simplificada de exportacion                                                          0=Export declaration;1=Simplified export declaration                                                                                                                                                                                                                                                S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_NUMDE  := SF2->F2_DOC //CriaVar("CDL_NUMDE")      //C 120Num Dec     Num Dec     Statement NrNumero da Declaração     Numero de la Declaracion Statement Number         99999999999                                                                                                                                                                  €€€€€€€€€€€€€€                                                                                                                                       1–À  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  dCDL_DTDE   := CriaVar("CDL_DTDE")       //D  80Dt Declara  Fch Declara Statement DtData da Declaração       Fecha de la Declaracion  Statement Date                                                                                                                                                                                        €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_NATEXP := CriaVar("CDL_NATEXP")     //C  10Nat Exp     Mod Exp     ExportNatureNatureza da Exportação   Modalidad de la ExportaciNature of Export                                                      Pertence(" 01")                                                                                                                 €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                 0=Exportação Direta;1=Exportação Indireta                                                                                       0=Exportacion Directa;1=Exportacion Indirecta                                                                                   0=Direct Export;1=Indirect Export                                                                                                                                                                                                                                                                   S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_NRREG  := CriaVar("CDL_NRREG")      //C 120Nr Registro Nr Registro File Number Numero Registro de Exp.  Numero Registro de Exp.  Export File Number                                                                                                                                                                                    €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  dCDL_DTREG  := CriaVar("CDL_DTREG")      //D  80Dt Registro Fch RegistroFile Date   Data Registro Exp.       Fecha Registro Exp.      Export File Date                                                                                                                                                                                      €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_CHCEMB := SF2->F2_DOC //CriaVar("CDL_CHCEMB")     //C 160Nr. Conhec. Nr. Conocim.B.of Ladng# Conhecimento Embarque    Conocimiento Embarque    Bill of Lading Number                                                                                                                                                                                 €€€€€€€€€€€€€€                                                                                                                                       1–À  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  dCDL_DTCHC  := SF2->F2_EMISSAO //CriaVar("CDL_DTCHC")      //D  80Data Conhec.Fecha ConociWaybill DateDt. Conhecimento Emb.    Fch. Conocimiento Emb.   Waybill Date                                                                                                                                                                                          €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  dCDL_DTAVB  := SF2->F2_EMISSAO //CriaVar("CDL_DTAVB")      //D  80Data Averb. Fecha EndosoApprov.Date Data da Averbação        Fecha de Endoso          Approval Date                                                                                                                                                                                         €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_TPCHC  := CriaVar("CDL_TPCHC")      //C  20Tipo Conhec.Tipo ConocimBOL Type    Tp conhecimento SISCOMEX Tp cononimiento SISCOMEX SISCOMEX BOL Type                                                     ExistCpo("SX5","SV"+M->CDL_TPCHC)                                                                                               €€€€€€€€€€€€€€                                                                                                                                 SV    1–À  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_PAIS   := Posicione("SA1",1,xFilial("SA1")+SF2->F2_CLIENTE+SF2->F2_LOJA,"A1_PAIS") //C  30Cod Pais    Cod Pais    Ctry.Code   Cod Pais - SISCOMEX      Cod Pais - SISCOMEX      Country Code - SISCOMEX                                                                                                                                                                               €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_NRMEMO := SF2->F2_DOC //CriaVar("CDL_NRMEMO")      //C 160Nr MemorandoNr MemorandoMemo No.    Numero do Memorando      Número del Memorando     Memo Number                                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_FORNEC := CriaVar("CDL_FORNEC")     //C  60Cod Fornec. Cod Prov.   Supp.Code   Codigo do Fornecedor     Codigo del Proveedor     Supplier Code            @!                                           ExistCPO("SA2")                                                                                                                 €€€€€€€€€€€€€€                                                                                                                                 FOR   1†€   NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 001 S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_LOJFOR := CriaVar("CDL_LOJFOR")     //C  40Loja Fornec.Tienda ProveSupp.Unit   Loja do Fornecedor       Tienda del Proveedor     Supplier Unit            @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1†À   NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 002 S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
Local  cCDL_DOCORI := CriaVar("CDL_DOCORI")    //C  90Doc.Orig.   Doc.Orig.   Src.Doc.    Documento Original       Documento Original       Source Document          @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1žÀ   N                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   018 S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  cCDL_SERORI := CriaVar("CDL_SERORI")    //C  30Ser.Orig.   Ser.Orig.   Orig.Series Série do Doc. Original   Seie del doc. Original   Original Document Series @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1žÀ   N                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  cCDL_NFEXP  := CriaVar("CDL_NFEXP")     //C  90NF Exp.     F Exp.      Exp Invoice NF Exportação            Fact Exportacion         Export Invoice           @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1„€  SS R                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  cCDL_SEREXP := CriaVar("CDL_SEREXP")    //C  30Serie Exp.  Serie Exp.  Export SerieSerie NF Exportação      Serie F Exportacion      Export Invoice Series    @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1„€  SS R                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  cCDL_ESPEXP := CriaVar("CDL_ESPEXP")    //C  50Especie     Especie     Especie     Especie NF Exportação    Especie NF Exportação    Especie NF Exportação    @!                                           Vazio() .or. ExistCpo("SX5","42"+M->CDL_ESPEXP)                                                                                 €€€€€€€€€€€€€€                                                                                                                                 42    1þÀ  SS R                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  dCDL_EMIEXP := CriaVar("CDL_EMIEXP")    //D  80Emissao Exp.Emision Exp IssueExpInvcEmissao NF Exportação    Emisión NF Exportación   Issue of Export Invoice                                                                                                                                                                               €€€€€€€€€€€€€€                                                                                                                                       1„€  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  cCDL_CHVEXP := CriaVar("CDL_CHVEXP")    //C 440Chv. NFe    Clv.e-Fact  e-InvoiceKeyChave NF-e Exporta.      Clave e-Fact.Export.     Export e-Invoice Key     @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1„€  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  nCDL_QTDEXP := CriaVar("CDL_QTDEXP")    //N 162Qtde. Exp.  Ctd.Export. Exp.Qty.    Qtde. Exportada          Cantidad Exportada       Exported Qty.            @E 9,999,999,999,999.99                                                                                                                                                      €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  cCDL_UFEMB  := CriaVar("CDL_UFEMB")     //C  20UF Emb.     Prov.EmbarquShip.ST     UF de Embarque           Prov.Embarque            State of Shipment        @!                                           ExistCpo("SX5","12"+M->CDL_UFEMB)                                                                                               €€€€€€€€€€€€€€                                                                                                                                 12    1€€   NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  cCDL_LOCEMB := CriaVar("CDL_LOCEMB")    //C 600Local Emb.  Loc.EmbarqueShip.Place  Local de Embarque        Localidad de Embarque    Place of Shipment        @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1€€   NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
Local  cCDL_ITEMNF := CriaVar("CDL_ITEMNF")    //C  40Item NF.    Item NF.    Item NF.    Item da Nota Fiscal      Item da Nota Fiscal      Item da Nota Fiscal      @!                                           A926VCmPrd('SD2')                                                                                                               €€€€€€€€€€€€€€                                                                                                                                       1þÀ   NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
Local  cCDL_ITEORI := CriaVar("CDL_ITEORI")   //C  40Item.Orig.  Item.Orig.  Item.Orig.  Item do Doc. Original    Item do Doc. Original    Item do Doc. Original    @!                                           A926VCmPrd('SD1')                                                                                                               €€€€€€€€€€€€€€                                                                                                                                       1þÀ   NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
Local  cCDL_PRDORI := CriaVar("CDL_PRDORI")     //C 150Prod.Orig.  Prod.Orig.  Prod.Orig.  Produto do Doc. Original Produto do Doc. Original Produto do Doc. Original @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                 SD1PRD1þÀ S NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
Local  cCDL_PRODNF := CriaVar("CDL_PRODNF")     //C 150Prod.NF.    Prod.NF.    Prod.NF.    Produto do Doc. ExportacaProduto do Doc. ExportacaProduto do Doc. Exportaca@!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                 SD2PRD1þÀ S NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
Local  cCDL_ACDRAW := CriaVar("CDL_ACDRAW")   //C 200Num DrawbackNum DrawbackNum DrawbackNum Drawback             Num Drawback             Num Drawback             @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
Local  cCDL_LOCDES := CriaVar("CDL_LOCDES")    //C 600Loc DespachoLoc DespachoLoc DespachoLoc Despacho             Loc Despacho             Loc Despacho             @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
Local  cCDL_CODMOE := CriaVar("CDL_CODMOE")     //C  30Cód.Moeda   Cód.Moeda   Cód.Moeda   Cód. Moeda Negociada     Cód. Moeda Negociada     Cód. Moeda Negociada     @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
Local  nCDL_VLREXP := CriaVar("CDL_VLREXP")    //N 142Vl.Despacho Vl.Despacho Vl.Despacho Valor Despacho           Valor Despacho           Valor Despacho           @E 99,999,999,999.99                                                                                                                                                         €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
Local  cCDL_NRDESP := CriaVar("CDL_NRDESP")     //C 110Nr.Despacho Nr.Despacho Nr.Despacho Número do Despacho       Número do Despacho       Número do Despacho       @E                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
Local  aCDL_NATEXP := {"0=Exportacao Direta","1=Exportacao Indireta"}
Local  aCDL_INDDOC := {"0=Declaracao de Exportacao","1=Declaracao simplificada de exportacao"}
Local  cCDL_SDOC   := SF2->F2_SERIE
Local  cEstCli     := Posicione("SA1",1,xFilial("SA1")+SF2->F2_CLIENTE+SF2->F2_LOJA,"A1_EST")
Local  cCLINom     := Posicione("SA1",1,xFilial("SA1")+SF2->F2_CLIENTE+SF2->F2_LOJA,"A1_NOME")

@ 131,500 To 600,1250 Dialog oDlg1 Title OemToAnsi("Atualização para Impressao Nota Fiscal EXPORTACAO")

@ 10,005 Say OemToAnsi("NOTA FISCAL:")			Size 44,80
@ 10,060 Get cF2_DOC   		Picture "@!" 									When .F. Size 030,10
@ 10,105 Say OemToAnsi("CLIENTE:")				Size 44,80
@ 10,140 Get cCLINom		Picture "@!" 									When .F. Size 130,10

@ 35,005 Say OemToAnsi("VOLUME:") 			 	Size 44,80
@ 35,070 Get nF2_VOLUME1 Picture  "@E 999"  								When .T. Size 030,10
@ 35,130 Say OemToAnsi("ESPECIE:")  			Size 44,80
@ 35,165 Get cF2_ESPECI1 Picture  "@!" 									When .T. Size 030,10

@ 50,005 Say OemToAnsi("P. BRUTO:")   		    	Size 44,80
@ 50,070 Get nF2_PBRUTO		Picture "@E 999,999.9999" 	Valid(nF2_PBRUTO>0)			When .T. Size 050,10
@ 50,130 Say OemToAnsi("P. LIQUIDO:")		        Size 44,80
@ 50,165 Get nF2_PLIQUI		Picture "@E 999,999.9999" 	Valid(nF2_PLIQUI>0)		When .T. Size 050,10

@ 65,005 Say OemToAnsi("TRANSPORTADORA:")       Size 50,080
@ 65,070 Get cF2_TRANSP    Picture "@!"                                   WHEN .T. SIZE 050,10  F3("SA4")
@ 65,130 Say OemToAnsi("Tipo Conhec.:") Size 44,100
@ 65,165 Get cCDL_TPCHC  Picture "@!" F3 "SV" VALID ExistCpo("SX5","SV"+cCDL_TPCHC) WHEN .T. SIZE 050,10

@ 85,005 Say OemToAnsi("Nat Exp:")       Size 50,080
@ 85,070 ComboBox cCDL_NATEXP Items aCDL_NATEXP Size 090,050 Object oCombo1
@ 85,225 Say OemToAnsi("Tipo Doc:") Size 44,100
@ 85,260 ComboBox cCDL_INDDOC Items aCDL_INDDOC Size 090,050 Object oCombo2

@105,005 Say OemToAnsi("Num Dec:")       	 		Size 54,80
@105,070 Get cCDL_NUMDE     Picture  "@!"    								When .T. Size 050,10
@105,130 Say OemToAnsi("Dt Declara:")                Size 44,80
@105,165 Get dCDL_DTDE      Picture  "@E"                                   When .T. Size 050,10
//@100,225 SAY OemToAnsi("TIPO DE DI:") Size 44,080
//@100,260 ComboBox cTPIMP Items aTPIMP Size 110,050 Object oCombo3

@ 135,005 Say OemToAnsi("Local Emb.:")       Size 50,100
@ 135,070 Get cCDL_LOCEMB    Picture "@!"                                  WHEN .T. SIZE 050,10
@ 135,130 Say OemToAnsi("UF Emb.:")       Size 44,100
@ 135,165 Get cCDL_UFEMB  Picture   "@!"                                  WHEN .T. SIZE 020,10

@ 155,005 Say OemToAnsi("Num Drawback:") Size 44,100
@ 155,070 Get cCDL_ACDRAW Picture "@!"                                   WHEN .T. SIZE 050,10

@ 175,005 SAY OemToAnsi("Nr Registro:") Size 44,080
@ 175,070 Get cCDL_NRREG PICTURE "@!"                                        WHEN .T. SIZE 060,10
@ 175,135 SAY OemToAnsi("Dt Registro :") Size 44,080
@ 175,170 Get dCDL_DTREG PICTURE "@E"                                        WHEN .T. SIZE 050,10

@ 195,005 Say OemToAnsi("Loc Despacho:") Size 44,100
@ 195,070 Get cCDL_LOCDES Picture "@!"                                       WHEN .T. SIZE 050,10
@ 195,135 SAY OemToAnsi("Vl.Despacho:") Size 44,100
@ 195,200 GET nCDL_VLREXP PICTURE "999999999.99"                              WHEN .T. SIZE 050,10

@ 215,005 BmpButton Type 01 Action Eval( {||nOpc:= 1,  oDlg1:End() } )
@ 215,070 BmpButton Type 02 Action Eval( {||/*nOpc:= 0,*/ oDlg1:End() } )

Activate Dialog oDlg1 Centered

If nOpc == 1
	
	dbSelectArea("SF2")
	RecLock("SF2",.F.)
	SF2->F2_TRANSP          := cF2_TRANSP
	SF2->F2_ESPECI1			:= cF2_ESPECI1
	SF2->F2_PBRUTO      	:= nF2_PBRUTO
	SF2->F2_PLIQUI 	 		:= nF2_PLIQUI
	SF2->F2_VOLUME1    		:= nF2_VOLUME1
	SF2->(MsUnlock())
	

	DBSELECTAREA("SD2")
	DBSETORDER(3)
	DBSEEK(xFilial("SD2")+SF2->F2_DOC+SF2->F2_SERIE+SF2->F2_CLIENTE+SF2->F2_LOJA,.T.)
	
	While !Eof() .And. xFilial("SD2") = SD2->D2_FILIAL;
		.And. SF2->F2_DOC = SD2->D2_DOC;
		.And. SF2->F2_SERIE = SD2->D2_SERIE;
		.And. SF2->F2_CLIENTE = SD2->D2_CLIENTE;
		.And. SF2->F2_LOJA = SD2->D2_LOJA
		
		If substring(SD2->D2_CF,1,1) = "7" //somente para Itens de Importação
			
			DBSELECTAREA("CDL")
			DBSETORDER(2)
			DBSEEK(xFilial("CDL")+SD2->D2_DOC+SD2->D2_SERIE+SD2->D2_CLIENTE+SD2->D2_LOJA+SD2->D2_ITEM,.T.)
			//2 - CDL_FILIAL+CDL_DOC+CDL_SERIE+CDL_CLIENT+CDL_LOJA+CDL_ITEMNF+CDL_NUMDE+CDL_DOCORI+CDL_SERORI+CDL_FORNEC+CDL_LOJFOR+CDL_NRREG                                     
			
			IF Found()                    // GRAVA NA TABELA DE DADOS COMPLEMENTARES DA NF
				RECLOCK("CDL",.F.)
			ELSE
				RECLOCK("CDL",.T.)
				CDL->CDL_FILIAL := xFilial("CDL")
				CDL->CDL_DOC   	:= SD2->D2_DOC
				CDL->CDL_SERIE 	:= SD2->D2_SERIE
				CDL->CDL_CLIENT	:= SD2->D2_CLIENTE
				CDL->CDL_LOJA  	:= SD2->D2_LOJA
				CDL->CDL_ITEMNF := SD2->D2_ITEM
			ENDIF
			CDL->CDL_SDOC	:= cCDL_SDOC
			CDL->CDL_ESPEC  := cCDL_ESPEC //C  50Especie     Especie     Type        Especie do documento     Especie del documento    Type of Document                                                                                                                                                                                      €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNVR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_INDDOC := cCDL_INDDOC     //C  10Tipo Doc    Tipo Doc    DocumentTypeTipo de documento        Tipo de documento        Document Type            @!                                           Pertence(" 01")                                                                                                                 €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                 0=Declaração de Exportação;1=Declaração simplificada de exportação                                                              0=Declaracion de Exportacion;1=Declaracion simplificada de exportacion                                                          0=Export declaration;1=Simplified export declaration                                                                                                                                                                                                                                                S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_NUMDE  := cCDL_NUMDE      //C 120Num Dec     Num Dec     Statement NrNumero da Declaração     Numero de la Declaracion Statement Number         99999999999                                                                                                                                                                  €€€€€€€€€€€€€€                                                                                                                                       1–À  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_DTDE   := dCDL_DTDE       //D  80Dt Declara  Fch Declara Statement DtData da Declaração       Fecha de la Declaracion  Statement Date                                                                                                                                                                                        €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_NATEXP := cCDL_NATEXP     //C  10Nat Exp     Mod Exp     ExportNatureNatureza da Exportação   Modalidad de la ExportaciNature of Export                                                      Pertence(" 01")                                                                                                                 €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                 0=Exportação Direta;1=Exportação Indireta                                                                                       0=Exportacion Directa;1=Exportacion Indirecta                                                                                   0=Direct Export;1=Indirect Export                                                                                                                                                                                                                                                                   S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_NRREG  := cCDL_NRREG      //C 120Nr Registro Nr Registro File Number Numero Registro de Exp.  Numero Registro de Exp.  Export File Number                                                                                                                                                                                    €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_DTREG  := dCDL_DTREG      //D  80Dt Registro Fch RegistroFile Date   Data Registro Exp.       Fecha Registro Exp.      Export File Date                                                                                                                                                                                      €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_CHCEMB := cCDL_CHCEMB     //C 160Nr. Conhec. Nr. Conocim.B.of Ladng# Conhecimento Embarque    Conocimiento Embarque    Bill of Lading Number                                                                                                                                                                                 €€€€€€€€€€€€€€                                                                                                                                       1–À  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_DTCHC  := dCDL_DTCHC      //D  80Data Conhec.Fecha ConociWaybill DateDt. Conhecimento Emb.    Fch. Conocimiento Emb.   Waybill Date                                                                                                                                                                                          €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_DTAVB  := dCDL_DTAVB      //D  80Data Averb. Fecha EndosoApprov.Date Data da Averbação        Fecha de Endoso          Approval Date                                                                                                                                                                                         €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_TPCHC  := cCDL_TPCHC      //C  20Tipo Conhec.Tipo ConocimBOL Type    Tp conhecimento SISCOMEX Tp cononimiento SISCOMEX SISCOMEX BOL Type                                                     ExistCpo("SX5","SV"+M->CDL_TPCHC)                                                                                               €€€€€€€€€€€€€€                                                                                                                                 SV    1–À  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_PAIS   := cCDL_PAIS       //C  30Cod Pais    Cod Pais    Ctry.Code   Cod Pais - SISCOMEX      Cod Pais - SISCOMEX      Country Code - SISCOMEX                                                                                                                                                                               €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_NRMEMO := cCDL_NRMEMO      //C 160Nr MemorandoNr MemorandoMemo No.    Numero do Memorando      Número del Memorando     Memo Number                                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_FORNEC := cCDL_FORNEC//C  60Cod Fornec. Cod Prov.   Supp.Code   Codigo do Fornecedor     Codigo del Proveedor     Supplier Code            @!                                           ExistCPO("SA2")                                                                                                                 €€€€€€€€€€€€€€                                                                                                                                 FOR   1†€   NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 001 S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_LOJFOR := cCDL_LOJFOR//C  40Loja Fornec.Tienda ProveSupp.Unit   Loja do Fornecedor       Tienda del Proveedor     Supplier Unit            @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1†À   NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 002 S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NNN                  
			CDL->CDL_DOCORI := SD2->D2_NFORI  //C  90Doc.Orig.   Doc.Orig.   Src.Doc.    Documento Original       Documento Original       Source Document          @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1žÀ   N                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   018 S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_SERORI := SD2->D2_SERIORI //C  30Ser.Orig.   Ser.Orig.   Orig.Series Série do Doc. Original   Seie del doc. Original   Original Document Series @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1žÀ   N                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_NFEXP  := cCDL_NFEXP//C  90NF Exp.     F Exp.      Exp Invoice NF Exportação            Fact Exportacion         Export Invoice           @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1„€  SS R                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_SEREXP := cCDL_SEREXP//C  30Serie Exp.  Serie Exp.  Export SerieSerie NF Exportação      Serie F Exportacion      Export Invoice Series    @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1„€  SS R                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_ESPEXP := cCDL_ESPEXP//C  50Especie     Especie     Especie     Especie NF Exportação    Especie NF Exportação    Especie NF Exportação    @!                                           Vazio() .or. ExistCpo("SX5","42"+M->CDL_ESPEXP)                                                                                 €€€€€€€€€€€€€€                                                                                                                                 42    1þÀ  SS R                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_EMIEXP := dCDL_EMIEXP//D  80Emissao Exp.Emision Exp IssueExpInvcEmissao NF Exportação    Emisión NF Exportación   Issue of Export Invoice                                                                                                                                                                               €€€€€€€€€€€€€€                                                                                                                                       1„€  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_CHVEXP := cCDL_CHVEXP//C 440Chv. NFe    Clv.e-Fact  e-InvoiceKeyChave NF-e Exporta.      Clave e-Fact.Export.     Export e-Invoice Key     @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1„€  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_QTDEXP := SD2->D2_QUANT //N 162Qtde. Exp.  Ctd.Export. Exp.Qty.    Qtde. Exportada          Cantidad Exportada       Exported Qty.            @E 9,999,999,999,999.99                                                                                                                                                      €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_UFEMB  := cCDL_UFEMB     //C  20UF Emb.     Prov.EmbarquShip.ST     UF de Embarque           Prov.Embarque            State of Shipment        @!                                           ExistCpo("SX5","12"+M->CDL_UFEMB)                                                                                               €€€€€€€€€€€€€€                                                                                                                                 12    1€€   NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_LOCEMB := cCDL_LOCEMB    //C 600Local Emb.  Loc.EmbarqueShip.Place  Local de Embarque        Localidad de Embarque    Place of Shipment        @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1€€   NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NN                   
			CDL->CDL_ITEORI := SD2->D2_ITEMORI //C  40Item.Orig.  Item.Orig.  Item.Orig.  Item do Doc. Original    Item do Doc. Original    Item do Doc. Original    @!                                           A926VCmPrd('SD1')                                                                                                               €€€€€€€€€€€€€€                                                                                                                                       1þÀ   NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
			CDL->CDL_PRDORI := cCDL_PRDORI//C 150Prod.Orig.  Prod.Orig.  Prod.Orig.  Produto do Doc. Original Produto do Doc. Original Produto do Doc. Original @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                 SD1PRD1þÀ S NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
			CDL->CDL_PRODNF := SD2->D2_COD //cCDL_PRODNF//C 150Prod.NF.    Prod.NF.    Prod.NF.    Produto do Doc. ExportacaProduto do Doc. ExportacaProduto do Doc. Exportaca@!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                 SD2PRD1þÀ S NAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
			CDL->CDL_ACDRAW := cCDL_ACDRAW //C 200Num DrawbackNum DrawbackNum DrawbackNum Drawback             Num Drawback             Num Drawback             @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
			CDL->CDL_LOCDES := cCDL_LOCDES  //C 600Loc DespachoLoc DespachoLoc DespachoLoc Despacho             Loc Despacho             Loc Despacho             @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SNAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
			CDL->CDL_CODMOE := cCDL_CODMOE   //C  30Cód.Moeda   Cód.Moeda   Cód.Moeda   Cód. Moeda Negociada     Cód. Moeda Negociada     Cód. Moeda Negociada     @!                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
			CDL->CDL_VLREXP := nCDL_VLREXP  //N 142Vl.Despacho Vl.Despacho Vl.Despacho Valor Despacho           Valor Despacho           Valor Despacho           @E 99,999,999,999.99                                                                                                                                                         €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
			CDL->CDL_NRDESP := cCDL_NRDESP   //C 110Nr.Despacho Nr.Despacho Nr.Despacho Número do Despacho       Número do Despacho       Número do Despacho       @E                                                                                                                                                                           €€€€€€€€€€€€€€                                                                                                                                       1þÀ  SSAR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
			MSUNLOCK()
			
		EndIf
		
		dbSelectArea("SD2")
		dbSkip()
		
	EndDo
	
EndIf

dbSelectArea("CDL")
dbSetOrder(1)

RestArea(aGetArea)

Return